# 단일 마이그레이션 파일 생성 및 관리 가이드

이 문서는 여러 개의 마이그레이션 파일을 생성하지 않고, **본인이 수정한 내역만 딱 하나의 SQL 파일로 추출하여 커밋하는 방법**을 설명합니다. 

특히 `@app/insight` 담당자처럼 특정 영역만 작업하고, 다른 영역의 스키마를 건드리지 않아야 할 때 유용한 방식입니다.

---

## 💡 핵심 원리
라이브(Remote) DB를 기준으로 현재 내 로컬 DB의 상태를 비교(Diff)하여, **원격에는 없고 로컬에만 있는 변경 사항**만 뽑아내어 하나의 파일로 만드는 방식입니다.

---

## 🛠️ 수행 단계

### 1단계: 로컬에서 DB 수정 작업 완료
먼저 로컬 Supabase(Studio UI 등)를 통해 테이블을 만들거나, 컬럼을 수정하는 등 원하는 모든 작업을 마칩니다.

### 2단계: 단일 변경 파일 생성 (Diff)
다음 명령어를 터미널에서 실행합니다. 이 명령어는 라이브 DB와 비교하여 '차이점'만 SQL 파일로 만들어줍니다.

```bash
# f 뒤에는 원하는 파일명을 입력하세요 (예: my_insight_update)
npx supabase db diff --linked -f my_insight_update
```

- **결과**: `supabase/migrations/YYYYMMDDHHMMSS_my_insight_update.sql` 파일이 하나 생성됩니다.
- **내용**: 이 파일 안에는 라이브 DB 대비 여러분이 로컬에서 추가하거나 수정한 내역만 포함됩니다.

### 3단계: 커밋 및 공유
생성된 **단 한 개의 .sql 파일**만 Git에 커밋합니다.
- 동료들이 이 파일을 `git pull` 받고 `npx supabase db reset`을 실행하면, 여러분이 작업한 내용만 동료의 로컬 DB에 깔끔하게 반영됩니다.

---

## ❓ 자주 묻는 질문

### Q. `seed.sql`은 무엇인가요?
- **`seed.sql`**은 DB의 '구조'가 아니라 그 안에 들어갈 **'데이터'**를 담고 있는 파일입니다. 
- 만약 동료가 여러분이 만든 테이블만 가지고는 테스트가 힘들다면, 여러분이 넣은 테스트 데이터를 `seed.sql`에 추가해서 같이 커밋해 줄 수 있습니다. (`npx supabase db dump --data-only --linked > supabase/seed.sql`)

### Q. 실수로 다른 테이블을 건드렸다면?
- 생성된 `.sql` 파일을 열어서 본인이 담당하지 않는 테이블(예: `clubs`, `meetups` 등)에 대한 `ALTER`나 `DROP` 쿼리가 들어있는지 확인하세요. 
- 있다면 해당 라인만 텍스트 편집기로 과감히 지우고 커밋하면 됩니다.

---

## 🎯 이 방식의 장점
1. **심플함**: 여러 마이그레이션 파일이 생기지 않아 Git 히스토리가 깨끗합니다.
2. **독립성**: 라이브 DB를 기준으로 비교하기 때문에, 동료의 작업물과 겹치지 않는 선에서 내 변경 분량만 정확히 뽑아낼 수 있습니다.
